![로고](https://github.com/YoonSeungKwon/Capstone1/blob/master/pding4.png)
# 프딩 Pding

## 1. 프로젝트 개요 
  프딩(프레젠트 펀딩, Present Funding)은 원하는 선물을 등록하면 친구들이 그 금액을 채워주는 크라우드 펀딩 형태의 모바일 중접 웹 서비스입니다.
  기존 선물 문화의 문제를 해결하고, 사용자들이 더 나은 선물 경험을 즐길 수 있도록 돕기 위해 제작되었습니다.

## 2. 팀 구성 (3인)
  + **팀장 윤상희**: 기획, 프론트엔드 개발
  + **팀원 기나연**: UX/UI 디자인
  + **팀원 윤승권**: 프론트엔드, 백엔드 개발 

 ## 3. 개발 환경 및 기술
  + **협업** :     Figma, Notion, Git, Swagger
  + **FE** :       JavaScript, React, Nginx
  + **BE** :       Java(jdk 17.), Spring Boot(3.3.), JPA/Hibernate
  + **INFRA** :    MariaDB, AWS EC2, AWS S3, Docker, RabbitMQ
  + **API** :      KAKAO Oauth2, KAKAO PAY

 ## 4. 서비스 특징

  - **1. 기술 확장을 고려한 설계**
    
    서비스 레이어에서 서비스 규모 확장 또는 기술 변경 시 유연하게 기술을 선택하여 변경 할 수 있도록 추상화를 통하여
     기능들을 구조로부터 분리하였다.  

    
   - **2. 쉬운 테스트를 위한 설계**
    
      서비스 레이어 단위 테스트 시 테스트 목적에 집중한 테스트를 위하여 외부 서비스 추상화와 빌더 패턴을 적극적으로
     활용하여 테스트 용 객체를 만들어 테스트 할 수  있도록 하였다.


## 5. 문제 해결

  - **응답 속도 개선**
    펀딩이 올라오고 단기적인 트래픽 상승을 대처하기 위하여 다음과 같은 해결을 진행하였다.
    
    1. **펀딩 엔티티 캐싱**
    
      자바 Caffeine 라이브러리를 이용하여 펀딩 글을 등록할 시 마감일 까지의 TTL을 설정하여 엔티티캐싱을 구현하였다.
      로컬 캐시를 통하여 네트워크 오버헤드 없이 결제 시 검증 과정을 빠르게 처리하였다.  

    2. **주문 데이터 버퍼링**
    
      초반에는 CAS를 사용하는 비동기 큐를 이용하여 주문 정보 WRITE작업 버퍼링을 구현하였지만, 주문 정보라는 데이터의
      안전성을 위하여 서버 비정상 시에도 영속적으로 데이터를 저장할 수 있는 RabbitMQ를 사용하여 버퍼링 작업을 구현하였다.
    
    3. **데이터베이스 튜닝**
    
      데이터베이스 엔진의 처리 과정을 고려해서 복합 키 인덱스를 설정하였다. 테스트 데이터로는 큰 속도 차이를 보이진 않았지만
      정렬 과정 없이 메인 쿼리가 동작하여, 장기적으로 성능이 좋도록 튜닝을 하였다.

      결과적으로 컴포넌트는 RabbitMQ를 추가로 도입하여, 단일 결제 요청 기준으로 약 100ms의 응답 속도에서
      약 50ms으로 테스트 환경에서 약 50ms 가량의 응답 속도를 단축 시킬 수 있었다.

    
- **OSIV 문제 해결**
    
    인증 객체로 사용되던 JPA 엔티티가 OSIV 인터셉터 범위 밖인 필터에서 사용되어 LazyInitializationException이 발생하였다.
    OSIV 인터셉터를 필터로 바꾸거나, Eagle Loading을 사용하는 방법이 있었지만 DB 커넥션에 의존적이지 않은 서비스를 위하여
    인증 DTO를 따로 만들어서 전체적인 인증 과정을 리팩터링하고, 데이터베이스에서 DTO로 반환 받는 쿼리를 작성하였다.  


- **단위 테스트**

    서비스 레이어를 단위 테스트 할 때 리포지토리에 의존성이 강하여 단위 테스트하는 것에 어려움을 겪었다.
    따라서 서비스와 리포지토리 사이에 추상화를 통하여 의존성을 역전시키고, Fake 리포지토리를 구현하여 테스트를 진행하였다.
    또한 Fake 리포지토리에 자체적인 컬랙션을 이용하여 데이터베이스 연동 없이 임시적인 반환 값을 테스트 할 수 있도록 구현하였다.





## 7. ERD
![데이터베이스](https://github.com/YoonSeungKwon/Capstone1/blob/master/pding3.png)

## 8. 결과물

![경진대회](https://github.com/YoonSeungKwon/Capstone1/blob/master/pding6.png)
![과제전](https://github.com/YoonSeungKwon/Capstone1/blob/master/pding7.png)

## 9. 링크
+ **프론트엔드**: <https://github.com/YoonSeungKwon/PdingFE>


+ **성능 개선기**: <https://www.notion.so/1cbaf94f960c80fa97f8d71034f264e1>
